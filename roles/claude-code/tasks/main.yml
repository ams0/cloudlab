---
- name: Install Node.js and npm (required for Claude Code)
  apt:
    name:
      - nodejs
      - npm
    state: present
    update_cache: yes

- name: Check if Claude Code is already installed
  shell: npm list -g @anthropic-ai/claude-code
  register: claude_installed_check
  failed_when: false
  changed_when: false

- name: Install Claude Code via npm
  npm:
    name: "@anthropic-ai/claude-code"
    global: yes
    state: present
  when: claude_installed_check.rc != 0

- name: Verify Claude Code installation
  shell: claude --version
  register: claude_version_check
  changed_when: false
  failed_when: false

- name: Display installed Claude Code version
  debug:
    msg: "Installed Claude Code: {{ claude_version_check.stdout if claude_version_check.rc == 0 else 'Installation verification failed' }}"
